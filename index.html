<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Aplikasi Laporan GKM</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <!-- App CSS -->
  <link rel="stylesheet" href="styles.css">
</head>
<body class="bg-light">
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary sticky-top">
    <div class="container-fluid">
      <a class="navbar-brand fw-semibold" href="#" data-nav="home">GKM Reporter</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav" aria-controls="mainNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="mainNav">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item"><a class="nav-link active" href="#" data-nav="home">Beranda</a></li>
          <li class="nav-item"><a class="nav-link" href="#" data-nav="plan">Rencana</a></li>
          <li class="nav-item"><a class="nav-link" href="#" data-nav="history">History</a></li>
          <li class="nav-item"><a class="nav-link" href="#" data-nav="matrix">Matrik</a></li>
          <li class="nav-item"><a class="nav-link" href="#" data-nav="stats">Statistik</a></li>
          <li class="nav-item"><a class="nav-link" href="#" data-nav="sync">Sinkronisasi</a></li>
          <li class="nav-item"><a class="nav-link" href="#" data-nav="settings">Pengaturan</a></li>
        </ul>
        <div class="d-flex gap-2">
          <button id="btnExportXlsx" class="btn btn-outline-light btn-sm"><i class="bi bi-file-earmark-spreadsheet"></i> Export Excel</button>
          <button id="btnResetApp" class="btn btn-outline-warning btn-sm"><i class="bi bi-arrow-counterclockwise"></i> Reset</button>
        </div>
      </div>
    </div>
  </nav>

  <!-- Container -->
  <main class="container my-3">

    <!-- Alerts -->
    <div id="alertRegion"></div>

    <!-- Beranda -->
    <section id="view-home">
      <div class="card shadow-sm">
        <div class="card-header d-flex align-items-center justify-content-between">
          <span class="fw-semibold">Laporan GKM</span>
          <div class="small text-muted">Data tersimpan lokal & bisa disinkron</div>
        </div>
        <div class="card-body">
          <form id="formLaporan" autocomplete="off" novalidate>
            <div class="row g-3">
              <div class="col-12 col-md-6">
                <label class="form-label">Nama Askep <span class="text-danger">*</span></label>
                <input id="askep" type="text" class="form-control" required>
                <div class="form-text">Pisahkan koma jila lebih dari 1.</div>
              </div>
              <div class="col-6 col-md-3">
                <label class="form-label">Divisi <span class="text-danger">*</span></label>
                <input id="divisi" type="text" class="form-control" required>
              </div>
              <div class="col-6 col-md-3">
                <label class="form-label">Unit <span class="text-danger">*</span></label>
                <input id="unit" type="text" class="form-control" required>
              </div>
              <div class="col-12 col-md-4">
                <label class="form-label">Region <span class="text-danger">*</span></label>
                <input id="region" type="text" class="form-control" required>
              </div>
              <div class="col-12 col-md-4">
                <label class="form-label">Hari & Waktu <span class="text-danger">*</span></label>
                <input id="waktu" type="date" class="form-control" required>
                <div class="form-text">Ditampilkan sebagai dddd, dd/mm/yyyy.</div>
              </div>
              <div class="col-12 col-md-4">
                <label class="form-label">Durasi (menit) <span class="text-danger">*</span></label>
                <input id="durasi" type="number" min="1" class="form-control" required>
              </div>

              <div class="col-12">
                <label class="form-label">Topik/Materi <span class="text-danger">*</span></label>
                <input id="topik" list="topikList" type="text" class="form-control" required>
                <datalist id="topikList"></datalist>
                <div class="form-text">Auto-suggest berdasarkan topik yang sering dipakai.</div>
              </div>

              <div class="col-12 col-md-6">
                <label class="form-label">Mandor yang mengajukan pertanyaan</label>
                <div class="tags-input" id="penanyaTags">
                  <input type="text" class="tag-input" id="penanyaInput" list="penanyaList" placeholder="Ketik nama, Enter" />
                  <datalist id="penanyaList"></datalist>
                </div>
                <div class="form-text">Tambah koma atau Enter setelah nama</div>
              </div>

              <div class="col-12 col-md-6">
                <label class="form-label">Mandor yang melakukan ringkasan</label>
                <div class="tags-input" id="perangkumTags">
                  <input type="text" class="tag-input" id="perangkumInput" list="perangkumList" placeholder="Ketik nama, Enter" />
                  <datalist id="perangkumList"></datalist>
                </div>
                <div class="form-text">Tambah koma atau Enter setelah nama</div>
              </div>

              <div class="col-12">
                <label class="form-label">Catatan</label>
                <textarea id="catatan" class="form-control" rows="2" placeholder="Opsional"></textarea>
              </div>
            </div>

            <div class="d-flex flex-wrap gap-2 mt-3">
              <button id="btnSimpan" type="submit" class="btn btn-primary">
                <span class="spinner-border spinner-border-sm me-2 d-none" id="spinSave"></span>
                <i class="bi bi-save"></i> Simpan
              </button>
              <button id="btnClearForm" type="button" class="btn btn-outline-secondary">Reset Form</button>
            </div>
          </form>
        </div>
      </div>
    </section>

    <!-- Rencana -->
<section id="view-plan" class="d-none">
  <div class="card shadow-sm">
    <div class="card-header d-flex align-items-center justify-content-between">
      <span class="fw-semibold">Rencana GKM</span>
      <div class="small text-muted">Askep/Divisi/Unit/Region ingat default; Hari & Topik dikosongkan setelah simpan</div>
    </div>
    <div class="card-body">
      <form id="formRencana" autocomplete="off" novalidate>
        <div class="row g-3">
          <div class="col-12 col-md-6">
            <label class="form-label">Nama Askep <span class="text-danger">*</span></label>
            <input id="rencAskep" type="text" class="form-control" required>
            <div class="form-text">Pisahkan koma jika lebih dari 1.</div>
          </div>
          <div class="col-6 col-md-3">
            <label class="form-label">Divisi <span class="text-danger">*</span></label>
            <input id="rencDivisi" type="text" class="form-control" required>
          </div>
          <div class="col-6 col-md-3">
            <label class="form-label">Unit <span class="text-danger">*</span></label>
            <input id="rencUnit" type="text" class="form-control" required>
          </div>
          <div class="col-12 col-md-4">
            <label class="form-label">Region <span class="text-danger">*</span></label>
            <input id="rencRegion" type="text" class="form-control" required>
          </div>
          <div class="col-12 col-md-4">
            <label class="form-label">Hari & Waktu <span class="text-danger">*</span></label>
            <input id="rencTanggal" type="date" class="form-control" required>
          </div>
          <div class="col-12 col-md-4">
            <label class="form-label">Topik/Materi <span class="text-danger">*</span></label>
            <input id="rencTopik" list="topikList" type="text" class="form-control" required>
            <!-- reuse #topikList dari Beranda -->
            <div class="form-text">Auto-suggest berdasarkan topik yang sering dipakai.</div>
          </div>
        </div>
        <div class="d-flex flex-wrap gap-2 mt-3">
          <button id="btnSimpanRencana" type="submit" class="btn btn-primary">
            <span class="spinner-border spinner-border-sm me-2 d-none" id="spinSaveRencana"></span>
            <i class="bi bi-calendar-plus"></i> Simpan Rencana
          </button>
          <button id="btnClearRencana" type="button" class="btn btn-outline-secondary">Reset</button>
        </div>
      </form>
    </div>
  </div>
</section>

    <!-- History -->
    <section id="view-history" class="d-none">
      <div class="card shadow-sm">
        <div class="card-header d-flex flex-wrap gap-2 align-items-center">
          <span class="fw-semibold">History Laporan</span>
          <div class="ms-auto d-flex flex-wrap gap-2">
            <input id="historySearch" type="search" class="form-control form-control-sm" placeholder="Cari...">
            <select id="pageSize" class="form-select form-select-sm" style="width:auto;">
              <option value="10">10</option>
              <option value="20" selected>20</option>
              <option value="50">50</option>
              <option value="100">100</option>
            </select>
          </div>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive nowrap-scroll">
            <table class="table table-striped table-hover align-middle mb-0">
              <thead class="table-light">
                <tr>
                  <th>Tanggal</th><th>Askep</th><th>Divisi</th><th>Unit</th><th>Region</th>
                  <th>Topik</th><th>Durasi</th><th>Penanya(#)</th><th>Perangkum(#)</th><th>Aksi</th><th>Sync</th>
                </tr>
              </thead>
              <tbody id="historyBody"></tbody>
            </table>
          </div>
          <div class="d-flex justify-content-between align-items-center p-2">
            <div class="small text-muted" id="historyInfo">0 data</div>
            <nav><ul class="pagination pagination-sm mb-0" id="historyPager"></ul></nav>
          </div>
        </div>
      </div>
    </section>

    <!-- Matrik -->
<section id="view-matrix" class="d-none">
  <div class="card shadow-sm">
    <div class="card-header d-flex flex-wrap gap-2 align-items-center">
      <span class="fw-semibold">Matrik Rencana & Aktual</span>
      <div class="ms-auto d-flex flex-wrap gap-2">
        <select id="mxMode" class="form-select form-select-sm" style="width:auto;">
          <option value="year" selected>1 Tahun</option>
          <option value="month">1 Bulan</option>
        </select>
        <input id="mxYear" type="number" class="form-control form-control-sm" style="width:110px;" min="2000" max="2100">
        <select id="mxMonth" class="form-select form-select-sm d-none" style="width:auto;">
          <option value="0">Januari</option><option value="1">Februari</option><option value="2">Maret</option>
          <option value="3">April</option><option value="4">Mei</option><option value="5">Juni</option>
          <option value="6">Juli</option><option value="7">Agustus</option><option value="8">September</option>
          <option value="9">Oktober</option><option value="10">November</option><option value="11">Desember</option>
        </select>
        <button id="btnMxRefresh" class="btn btn-primary btn-sm"><i class="bi bi-arrow-repeat"></i> Refresh</button>
        <button id="btnMxXlsx" class="btn btn-outline-success btn-sm"><i class="bi bi-file-earmark-spreadsheet"></i> Export XLSX</button>
        <button id="btnMxPdf" class="btn btn-outline-danger btn-sm"><i class="bi bi-filetype-pdf"></i> Export PDF</button>
        <button id="btnMxAdmin" class="btn btn-outline-secondary btn-sm" title="Admin">
          <i class="bi bi-gear"></i>
        </button>
      </div>
    </div>
    <div class="card-body">
      <div id="mxInfo" class="small text-muted mb-2">Mode lokal.</div>
      <div id="mxWrap" class="mx-grid"></div>
    </div>
  </div>
</section>

    <!-- Statistik -->
    <section id="view-stats" class="d-none">
      <div class="card shadow-sm">
        <div class="card-header fw-semibold">Statistik</div>
        <div class="card-body">
          <div class="row g-3">
            <div class="col-12 col-md-3"><label class="form-label">Mulai</label><input type="date" id="statFrom" class="form-control"></div>
            <div class="col-12 col-md-3"><label class="form-label">Akhir</label><input type="date" id="statTo" class="form-control"></div>
            <div class="col-12 col-md-3"><label class="form-label">Unit</label><input type="text" id="statUnit" class="form-control"></div>
            <div class="col-12 col-md-3"><label class="form-label">Divisi</label><input type="text" id="statDivisi" class="form-control"></div>
          </div>
          <div class="mt-3 d-flex gap-2">
            <button id="btnHitungStat" class="btn btn-primary"><span class="spinner-border spinner-border-sm me-2 d-none" id="spinStat"></span>Hitung</button>
            <button id="btnClearStat" class="btn btn-outline-secondary">Bersihkan</button>
          </div>
          <hr>
          <div class="row g-3">
            <div class="col-12 col-lg-4"><div class="stat-card"><div class="label">Jumlah Sesi</div><div class="value" id="statJumlah">0</div></div></div>
            <div class="col-12 col-lg-4"><div class="stat-card"><div class="label">Topik Terpopuler</div><div class="value" id="statTopik">-</div></div></div>
            <div class="col-12 col-lg-4"><div class="stat-card"><div class="label">Rata-rata Durasi</div><div class="value" id="statDurasi">0 mnt</div></div></div>
          </div>
          <div class="row g-3 mt-2">
            <div class="col-12 col-md-6"><h6>Mandor Paling Aktif Bertanya (Top-10)</h6><ol id="statPenanyaTop" class="mb-0"></ol></div>
            <div class="col-12 col-md-6"><h6>Mandor Paling Sering Meringkas (Top-10)</h6><ol id="statPerangkumTop" class="mb-0"></ol></div>
          </div>
        </div>
      </div>
    </section>

    <!-- Sinkronisasi -->
    <section id="view-sync" class="d-none">
      <div class="card shadow-sm">
        <div class="card-header fw-semibold d-flex justify-content-between align-items-center">
          <span>Sinkronisasi ke Google Sheets</span>
          <span class="badge text-bg-light">Antrean: <span id="syncQueueCount">0</span></span>
        </div>
        <div class="card-body">
          <div class="row g-3">
            <div class="col-12 col-md-8">
              <div class="form-text">Web App URL & Nama Sheet ada diaplikasi.</div>
            </div>
            <div class="col-12 col-md-4 text-md-end">
              <button id="btnSyncNow" class="btn btn-primary">
                <span class="spinner-border spinner-border-sm me-2 d-none" id="spinSync"></span>
                <i class="bi bi-cloud-arrow-up"></i> Sync sekarang
              </button>
            </div>
          </div>
          <hr>
          <div><strong>Status:</strong> <span id="syncStatus">Siap</span></div>
          <div class="small text-muted">Terakhir sync: <span id="lastSyncLabel">-</span></div>
        </div>
      </div>
    </section>

    <!-- Pengaturan -->
    <section id="view-settings" class="d-none">
      <div class="card shadow-sm">
        <div class="card-header fw-semibold">Pengaturan</div>
        <div class="card-body">
          <div class="row g-3">
            <div class="col-12 col-md-6">
              <label class="form-label">Default Askep</label>
              <input id="prefAskep" type="text" class="form-control" placeholder="Nama Askep default">
            </div>
            <div class="col-6 col-md-3">
              <label class="form-label">Default Divisi</label>
              <input id="prefDivisi" type="text" class="form-control" placeholder="SRIE1-2">
            </div>
            <div class="col-6 col-md-3">
              <label class="form-label">Default Unit</label>
              <input id="prefUnit" type="text" class="form-control" placeholder="SRIE">
            </div>
            <div class="col-12 col-md-4">
              <label class="form-label">Default Region</label>
              <input id="prefRegion" type="text" class="form-control" placeholder="Badau">
            </div>
          </div>
          <div class="mt-3">
            <button id="btnSimpanPrefs" class="btn btn-primary"><i class="bi bi-save"></i> Simpan Pengaturan</button>
          </div>
        </div>
      </div>
    </section>

  </main>

  <!-- Footer: Storage Meter -->
  <footer class="container my-3">
    <div class="card shadow-sm">
      <div class="card-body py-2 d-flex align-items-center gap-3">
        <div class="small text-muted">Storage terpakai:</div>
        <div class="progress flex-grow-1" style="height:12px;">
          <div id="storageBar" class="progress-bar" role="progressbar" style="width: 0%"></div>
        </div>
        <div id="storageLabel" class="small fw-semibold">0 KB / ~5 MB</div>
      </div>
    </div>
  </footer>

  <!-- Modal Generate WA -->
  <div class="modal fade" id="modalWA" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title"><i class="bi bi-whatsapp"></i> Generate Laporan WA</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Tutup"></button>
        </div>
        <div class="modal-body">
          <div class="row g-2 align-items-end">
            <div class="col-12 col-md-4">
              <label class="form-label">Tanggal Kegiatan</label>
              <input type="date" id="waTanggal" class="form-control">
            </div>
            <div class="col-12 col-md-8 text-end">
              <button class="btn btn-outline-secondary btn-sm" id="btnRegenWA"><i class="bi bi-arrow-repeat"></i> Perbarui</button>
            </div>
          </div>
          <hr>
          <label class="form-label">Teks WA</label>
          <textarea id="waPreview" class="form-control font-monospace" rows="14" readonly></textarea>
        </div>
        <div class="modal-footer">
          <button id="btnCopyWA" type="button" class="btn btn-success">
            <i class="bi bi-clipboard"></i> Salin
          </button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <!-- SheetJS for XLSX export -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <!-- jsPDF untuk export PDF -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <!-- App JS -->
  <script src="app.js"></script>
</body>
</html>
